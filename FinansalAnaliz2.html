<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detaylı Yazılım Projesi Finansal Modeli</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

            .header h1 {
                color: #2c3e50;
                font-size: 2.5em;
                margin-bottom: 10px;
                background: linear-gradient(135deg, #3498db, #9b59b6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
            }

        .input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

            .section h2 {
                color: #2c3e50;
                margin-bottom: 20px;
                font-size: 1.3em;
                border-bottom: 2px solid #3498db;
                padding-bottom: 10px;
            }

        .form-group {
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

            .form-row .form-group {
                flex: 1;
                margin-bottom: 0;
            }

        label {
            display: block;
            margin-bottom: 6px;
            color: #2c3e50;
            font-weight: 600;
            font-size: 0.9em;
        }

        .label-help {
            font-size: 0.8em;
            color: #7f8c8d;
            font-weight: normal;
        }

        input, select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

            input:focus, select:focus {
                outline: none;
                border-color: #3498db;
                box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
            }

        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 10px;
        }

            .btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(52, 152, 219, 0.3);
            }

        .results {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-top: 30px;
        }

            .results h2 {
                text-align: center;
                margin-bottom: 30px;
                font-size: 2em;
            }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

            .metric-card h3 {
                font-size: 1em;
                margin-bottom: 10px;
                opacity: 0.9;
            }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-description {
            opacity: 0.8;
            font-size: 0.85em;
        }

        .detailed-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.9em;
        }

            .detailed-table th,
            .detailed-table td {
                padding: 8px;
                text-align: center;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .detailed-table th {
                background: rgba(255, 255, 255, 0.1);
                font-weight: 600;
                font-size: 0.8em;
            }

        .positive {
            color: #2ecc71;
        }

        .negative {
            color: #e74c3c;
        }

        .neutral {
            color: #f39c12;
        }

        .explanation {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            border-left: 4px solid #3498db;
        }

            .explanation h3 {
                color: #2c3e50;
                margin-bottom: 15px;
            }

            .explanation p {
                color: #34495e;
                line-height: 1.6;
                margin-bottom: 10px;
                font-size: 0.9em;
            }

        .tab-container {
            margin-top: 20px;
        }

        .tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            padding: 15px;
            background: transparent;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }

            .tab.active {
                background: rgba(255, 255, 255, 0.2);
            }

        .tab-content {
            display: none;
        }

            .tab-content.active {
                display: block;
            }

        .info-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #f39c12;
        }

        @media (max-width: 768px) {
            .input-grid {
                grid-template-columns: 1fr;
            }

            .metrics {
                grid-template-columns: 1fr;
            }

            .form-row {
                flex-direction: column;
            }

            .detailed-table {
                font-size: 0.7em;
            }

                .detailed-table th,
                .detailed-table td {
                    padding: 4px;
                }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Detaylı Yazılım Projesi Finansal Modeli</h1>
            <p>Gelir-gider kalemleri, indirgeme faktörleri ve senaryo analizleri ile kapsamlı finansal değerlendirme</p>
        </div>

        <div class="input-grid">
            <!-- Proje Temel Bilgileri -->
            <div class="section">
                <h2>📊 Proje Temel Bilgileri</h2>
                <div class="form-group">
                    <label>Başlangıç Yatırımı <span class="label-help">(Geliştirme, ekipman, lisans)</span></label>
                    <input type="number" id="initialInvestment" value="750000" placeholder="750000">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Risk-free Rate <span class="label-help">(%)</span></label>
                        <input type="number" id="riskFreeRate" value="12" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Risk Primi <span class="label-help">(%)</span></label>
                        <input type="number" id="riskPremium" value="8" step="0.1">
                    </div>
                </div>

                <div class="form-group">
                    <label>Proje Süresi (Yıl)</label>
                    <select id="projectYears">
                        <option value="3">3 Yıl</option>
                        <option value="5" selected>5 Yıl</option>
                        <option value="7">7 Yıl</option>
                        <option value="10">10 Yıl</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Proje Aşaması</label>
                    <select id="projectStage">
                        <option value="poc">PoC Tamamlanmış</option>
                        <option value="mvp">MVP Hazır</option>
                        <option value="beta">Beta Aşaması</option>
                        <option value="launch">Lansman Hazır</option>
                    </select>
                </div>
            </div>

            <!-- Gelir Modeli -->
            <div class="section">
                <h2>💰 Detaylı Gelir Modeli</h2>
                <div class="form-group">
                    <label>Gelir Modeli Tipi</label>
                    <select id="revenueModel">
                        <option value="saas">SaaS Abonelik</option>
                        <option value="license">Lisans Satışı</option>
                        <option value="freemium">Freemium</option>
                        <option value="marketplace">Marketplace</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>İlk Yıl Müşteri Sayısı</label>
                        <input type="number" id="initialCustomers" value="50" placeholder="50">
                    </div>
                    <div class="form-group">
                        <label>Aylık Müşteri Büyüme <span class="label-help">(%)</span></label>
                        <input type="number" id="customerGrowthRate" value="15" step="0.1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ortalama Aylık Gelir/Müşteri (ARPU)</label>
                        <input type="number" id="arpu" value="500" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label>Yıllık Fiyat Artışı <span class="label-help">(%)</span></label>
                        <input type="number" id="priceIncrease" value="8" step="0.1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Müşteri Kaybı Oranı (Churn) <span class="label-help">(%/ay)</span></label>
                        <input type="number" id="churnRate" value="3" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Upselling Oranı <span class="label-help">(%/yıl)</span></label>
                        <input type="number" id="upsellRate" value="20" step="0.1">
                    </div>
                </div>
            </div>

            <!-- İşletme Giderleri -->
            <div class="section">
                <h2>💸 Detaylı İşletme Giderleri</h2>

                <h4 style="color: #34495e; margin-bottom: 10px;">Personel Giderleri (Aylık)</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Geliştirici Ekibi <span class="label-help">(kişi × maaş)</span></label>
                        <input type="number" id="devTeamCost" value="45000" placeholder="45000">
                    </div>
                    <div class="form-group">
                        <label>Pazarlama Ekibi</label>
                        <input type="number" id="marketingTeamCost" value="18000" placeholder="18000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Satış Ekibi</label>
                        <input type="number" id="salesTeamCost" value="25000" placeholder="25000">
                    </div>
                    <div class="form-group">
                        <label>Yönetim ve Destek</label>
                        <input type="number" id="managementCost" value="20000" placeholder="20000">
                    </div>
                </div>

                <h4 style="color: #34495e; margin-bottom: 10px; margin-top: 15px;">Operasyonel Giderler (Aylık)</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label>Sunucu & Bulut Hizmetleri</label>
                        <input type="number" id="infraCost" value="12000" placeholder="12000">
                    </div>
                    <div class="form-group">
                        <label>Yazılım Lisansları</label>
                        <input type="number" id="softwareLicenses" value="8000" placeholder="8000">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ofis & Kira</label>
                        <input type="number" id="officeCost" value="15000" placeholder="15000">
                    </div>
                    <div class="form-group">
                        <label>Pazarlama Bütçesi</label>
                        <input type="number" id="marketingBudget" value="20000" placeholder="20000">
                    </div>
                </div>

                <div class="form-group">
                    <label>Yıllık Gider Artış Oranı <span class="label-help">(%)</span></label>
                    <input type="number" id="expenseInflation" value="12" step="0.1">
                </div>
            </div>

            <!-- Değişken Maliyetler -->
            <div class="section">
                <h2>📈 Değişken Maliyetler & Diğer</h2>

                <div class="form-row">
                    <div class="form-group">
                        <label>Müşteri Kazanma Maliyeti (CAC)</label>
                        <input type="number" id="cac" value="800" placeholder="800">
                    </div>
                    <div class="form-group">
                        <label>Müşteri Destek Maliyeti <span class="label-help">(₺/müşteri/ay)</span></label>
                        <input type="number" id="supportCost" value="25" placeholder="25">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Ödeme İşlem Ücreti <span class="label-help">(% gelir)</span></label>
                        <input type="number" id="transactionFee" value="2.5" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Satış Komisyonu <span class="label-help">(% gelir)</span></label>
                        <input type="number" id="salesCommission" value="8" step="0.1">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Vergi Oranı <span class="label-help">(%)</span></label>
                        <input type="number" id="taxRate" value="25" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Amortisman (Yıllık)</label>
                        <input type="number" id="depreciation" value="50000" placeholder="50000">
                    </div>
                </div>
            </div>
        </div>

        <button class="btn" onclick="calculateDetailedMetrics()">🚀 Detaylı Finansal Analiz Yap</button>

        <div id="results" class="results" style="display: none;">
            <h2>📊 Detaylı Finansal Analiz Sonuçları</h2>

            <div class="info-box">
                <strong>İndirgeme Oranı (WACC):</strong> <span id="waccDisplay">-</span>
                (Risk-free Rate + Risk Primi + Sektör Risk Ayarlaması)
            </div>

            <div class="metrics">
                <div class="metric-card">
                    <h3>NPV (Net Bugünkü Değer)</h3>
                    <div class="metric-value" id="npvValue">-</div>
                    <div class="metric-description" id="npvDescription">-</div>
                </div>

                <div class="metric-card">
                    <h3>IRR (İç Getiri Oranı)</h3>
                    <div class="metric-value" id="irrValue">-</div>
                    <div class="metric-description" id="irrDescription">-</div>
                </div>

                <div class="metric-card">
                    <h3>ROI (Yatırım Getirisi)</h3>
                    <div class="metric-value" id="roiValue">-</div>
                    <div class="metric-description" id="roiDescription">-</div>
                </div>

                <div class="metric-card">
                    <h3>Payback Period</h3>
                    <div class="metric-value" id="paybackValue">-</div>
                    <div class="metric-description">Geri dönüş süresi</div>
                </div>

                <div class="metric-card">
                    <h3>LTV/CAC Oranı</h3>
                    <div class="metric-value" id="ltvCacValue">-</div>
                    <div class="metric-description">Müşteri değeri/maliyet</div>
                </div>

                <div class="metric-card">
                    <h3>Break-even Müşteri</h3>
                    <div class="metric-value" id="breakEvenCustomers">-</div>
                    <div class="metric-description">Başabaş müşteri sayısı</div>
                </div>
            </div>

            <div class="tab-container">
                <div class="tabs">
                    <button class="tab active" onclick="showTab('summary')">Özet Tablo</button>
                    <button class="tab" onclick="showTab('detailed')">Detaylı Gelir-Gider</button>
                    <button class="tab" onclick="showTab('metrics')">Ek Metrikler</button>
                </div>

                <div id="summary" class="tab-content active">
                    <table class="detailed-table" id="summaryTable">
                        <thead>
                            <tr>
                                <th>Yıl</th>
                                <th>Müşteri Sayısı</th>
                                <th>Toplam Gelir</th>
                                <th>Toplam Gider</th>
                                <th>EBITDA</th>
                                <th>Vergi Sonrası Kâr</th>
                                <th>Nakit Akışı</th>
                                <th>İndirgeli NA</th>
                                <th>Kümülatif NPV</th>
                            </tr>
                        </thead>
                        <tbody id="summaryBody">
                        </tbody>
                    </table>
                </div>

                <div id="detailed" class="tab-content">
                    <table class="detailed-table" id="detailedTable">
                        <thead>
                            <tr>
                                <th>Yıl</th>
                                <th>Abonelik Geliri</th>
                                <th>Personel Gideri</th>
                                <th>Operasyonel Gider</th>
                                <th>Değişken Gider</th>
                                <th>CAC Maliyeti</th>
                                <th>Amortisman</th>
                                <th>Vergi</th>
                            </tr>
                        </thead>
                        <tbody id="detailedBody">
                        </tbody>
                    </table>
                </div>

                <div id="metrics" class="tab-content">
                    <table class="detailed-table" id="metricsTable">
                        <thead>
                            <tr>
                                <th>Yıl</th>
                                <th>ARPU</th>
                                <th>Churn Rate</th>
                                <th>LTV</th>
                                <th>CAC</th>
                                <th>LTV/CAC</th>
                                <th>Gross Margin</th>
                                <th>Net Margin</th>
                            </tr>
                        </thead>
                        <tbody id="metricsBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="explanation">
            <h3>💡 Detaylı Finansal Model Açıklamaları</h3>
            <p><strong>WACC Hesaplama:</strong> Risk-free rate + risk primi + sektör riski. Yazılım projeleri için genellikle %15-25 arasındadır.</p>
            <p><strong>LTV (Lifetime Value):</strong> Bir müşterinin yaşam boyu getirdiği toplam değer. ARPU × (1/Churn Rate) × Gross Margin</p>
            <p><strong>CAC (Customer Acquisition Cost):</strong> Bir müşteri kazanmak için harcanan toplam maliyet.</p>
            <p><strong>SaaS Metrikleri:</strong> LTV/CAC > 3 olmalı, payback period < 12 ay optimal.</p>
            <p><strong>Senaryo Analizi:</strong> Farklı büyüme oranları ve churn değerleri ile risk analizi yapabilirsiniz.</p>
        </div>
    </div>

    <script>
        function calculateDetailedMetrics() {
            // Temel değerleri al
            const initialInvestment = parseFloat(document.getElementById('initialInvestment').value);
            const riskFreeRate = parseFloat(document.getElementById('riskFreeRate').value) / 100;
            const riskPremium = parseFloat(document.getElementById('riskPremium').value) / 100;
            const projectYears = parseInt(document.getElementById('projectYears').value);
            const projectStage = document.getElementById('projectStage').value;

            // Risk ayarlaması
            let stageRiskAdjustment = 0;
            switch (projectStage) {
                case 'poc': stageRiskAdjustment = 0.08; break;
                case 'mvp': stageRiskAdjustment = 0.05; break;
                case 'beta': stageRiskAdjustment = 0.03; break;
                case 'launch': stageRiskAdjustment = 0; break;
            }

            const wacc = riskFreeRate + riskPremium + stageRiskAdjustment;

            // Gelir parametreleri
            const initialCustomers = parseFloat(document.getElementById('initialCustomers').value);
            const customerGrowthRate = parseFloat(document.getElementById('customerGrowthRate').value) / 100;
            const arpu = parseFloat(document.getElementById('arpu').value);
            const priceIncrease = parseFloat(document.getElementById('priceIncrease').value) / 100;
            const churnRate = parseFloat(document.getElementById('churnRate').value) / 100;
            const upsellRate = parseFloat(document.getElementById('upsellRate').value) / 100;

            // Gider parametreleri
            const devTeamCost = parseFloat(document.getElementById('devTeamCost').value) * 12;
            const marketingTeamCost = parseFloat(document.getElementById('marketingTeamCost').value) * 12;
            const salesTeamCost = parseFloat(document.getElementById('salesTeamCost').value) * 12;
            const managementCost = parseFloat(document.getElementById('managementCost').value) * 12;
            const infraCost = parseFloat(document.getElementById('infraCost').value) * 12;
            const softwareLicenses = parseFloat(document.getElementById('softwareLicenses').value) * 12;
            const officeCost = parseFloat(document.getElementById('officeCost').value) * 12;
            const marketingBudget = parseFloat(document.getElementById('marketingBudget').value) * 12;
            const expenseInflation = parseFloat(document.getElementById('expenseInflation').value) / 100;

            // Değişken maliyetler
            const cac = parseFloat(document.getElementById('cac').value);
            const supportCost = parseFloat(document.getElementById('supportCost').value);
            const transactionFee = parseFloat(document.getElementById('transactionFee').value) / 100;
            const salesCommission = parseFloat(document.getElementById('salesCommission').value) / 100;
            const taxRate = parseFloat(document.getElementById('taxRate').value) / 100;
            const depreciation = parseFloat(document.getElementById('depreciation').value);

            // Yıllık hesaplamalar
            let yearlyData = [];
            let cashFlows = [-initialInvestment];
            let cumulativeNPV = [-initialInvestment];

            let currentCustomers = initialCustomers;
            let currentARPU = arpu;

            for (let year = 1; year <= projectYears; year++) {
                // Müşteri sayısı hesaplama (büyüme - churn)
                const newCustomers = currentCustomers * customerGrowthRate * 12; // Aylık büyüme
                const lostCustomers = currentCustomers * churnRate * 12; // Aylık kayıp
                currentCustomers = Math.max(0, currentCustomers + newCustomers - lostCustomers);

                // ARPU güncellemesi
                currentARPU = currentARPU * (1 + priceIncrease) * (1 + upsellRate / 12);

                // Gelir hesaplama
                const subscriptionRevenue = currentCustomers * currentARPU * 12;
                const totalRevenue = subscriptionRevenue;

                // Sabit giderler (enflasyon ile artış)
                const inflationMultiplier = Math.pow(1 + expenseInflation, year);
                const totalPersonnelCost = (devTeamCost + marketingTeamCost + salesTeamCost + managementCost) * inflationMultiplier;
                const totalOperationalCost = (infraCost + softwareLicenses + officeCost + marketingBudget) * inflationMultiplier;

                // Değişken giderler
                const transactionCosts = totalRevenue * transactionFee;
                const salesCommissionCost = totalRevenue * salesCommission;
                const supportCosts = currentCustomers * supportCost * 12;
                const cacCosts = newCustomers * cac;

                const totalVariableCosts = transactionCosts + salesCommissionCost + supportCosts + cacCosts;

                // Toplam giderler
                const totalExpenses = totalPersonnelCost + totalOperationalCost + totalVariableCosts + depreciation;

                // EBITDA ve kâr
                const ebitda = totalRevenue - (totalExpenses - depreciation);
                const taxableIncome = Math.max(0, ebitda - depreciation);
                const taxes = taxableIncome * taxRate;
                const netIncome = taxableIncome - taxes;
                const cashFlow = netIncome + depreciation; // Amortisman geri eklenir

                // Metrikler
                const ltv = (currentARPU * 12) / churnRate * 0.7; // Gross margin varsayımı
                const ltvCacRatio = ltv / cac;
                const grossMargin = (totalRevenue - totalVariableCosts) / totalRevenue;
                const netMargin = netIncome / totalRevenue;

                // Yıllık veriyi sakla
                yearlyData.push({
                    year: year,
                    customers: currentCustomers,
                    arpu: currentARPU,
                    subscriptionRevenue: subscriptionRevenue,
                    totalRevenue: totalRevenue,
                    personnelCost: totalPersonnelCost,
                    operationalCost: totalOperationalCost,
                    variableCosts: totalVariableCosts,
                    cacCosts: cacCosts,
                    totalExpenses: totalExpenses,
                    ebitda: ebitda,
                    depreciation: depreciation,
                    taxes: taxes,
                    netIncome: netIncome,
                    cashFlow: cashFlow,
                    ltv: ltv,
                    ltvCacRatio: ltvCacRatio,
                    grossMargin: grossMargin,
                    netMargin: netMargin,
                    churnRate: churnRate
                });

                cashFlows.push(cashFlow);

                // İndirgeli nakit akışı ve kümülatif NPV
                const discountedCashFlow = cashFlow / Math.pow(1 + wacc, year);
                const cumNPV = cumulativeNPV[cumulativeNPV.length - 1] + discountedCashFlow;
                cumulativeNPV.push(cumNPV);
            }

            // Ana metrikleri hesapla
            const npv = calculateNPV(cashFlows, wacc);
            const irr = calculateIRR(cashFlows);
            const totalCashFlow = cashFlows.slice(1).reduce((sum, cf) => sum + cf, 0);
            const roi = (totalCashFlow / initialInvestment) * 100;
            const paybackPeriod = calculatePaybackPeriod(cashFlows);

            // Ortalama LTV/CAC
            const avgLtvCac = yearlyData.reduce((sum, data) => sum + data.ltvCacRatio, 0) / yearlyData.length;

            // Break-even müşteri sayısı (ilk yıl için)
            const firstYearFixedCosts = yearlyData[0].personnelCost + yearlyData[0].operationalCost;
            const contributionMarginPerCustomer = (yearlyData[0].arpu * 12) - (supportCost * 12) - (yearlyData[0].arpu * 12 * (transactionFee + salesCommission));
            const breakEvenCustomers = Math.ceil(firstYearFixedCosts / contributionMarginPerCustomer);

            // Sonuçları göster
            displayDetailedResults(npv, irr, roi, paybackPeriod, avgLtvCac, breakEvenCustomers, wacc, yearlyData, cashFlows, cumulativeNPV);
        }

        function calculateNPV(cashFlows, discountRate) {
            let npv = cashFlows[0]; // İlk yatırım (negatif)
            for (let i = 1; i < cashFlows.length; i++) {
                npv += cashFlows[i] / Math.pow(1 + discountRate, i);
            }
            return npv;
        }

        function calculateIRR(cashFlows) {
            let rate = 0.1; // Başlangıç tahmini
            let tolerance = 0.0001;
            let maxIterations = 100;

            for (let i = 0; i < maxIterations; i++) {
                let npv = 0;
                let dnpv = 0;

                for (let j = 0; j < cashFlows.length; j++) {
                    npv += cashFlows[j] / Math.pow(1 + rate, j);
                    dnpv += -j * cashFlows[j] / Math.pow(1 + rate, j + 1);
                }

                if (Math.abs(npv) < tolerance) break;

                rate = rate - npv / dnpv;

                if (rate < -0.99) rate = -0.99;
                if (rate > 10) rate = 10;
            }

            return rate * 100;
        }

        function calculatePaybackPeriod(cashFlows) {
            let cumulativeCashFlow = cashFlows[0];

            for (let i = 1; i < cashFlows.length; i++) {
                if (cumulativeCashFlow < 0) {
                    cumulativeCashFlow += cashFlows[i];
                    if (cumulativeCashFlow >= 0) {
                        const previousCumulative = cumulativeCashFlow - cashFlows[i];
                        const payback = i - 1 + (-previousCumulative / cashFlows[i]);
                        return payback;
                    }
                }
            }
            return -1;
        }

        function displayDetailedResults(npv, irr, roi, paybackPeriod, avgLtvCac, breakEvenCustomers, wacc, yearlyData, cashFlows, cumulativeNPV) {
            // WACC gösterimi
            document.getElementById('waccDisplay').textContent = (wacc * 100).toFixed(1) + '%';

            // Ana metrikler
            document.getElementById('npvValue').textContent = formatCurrency(npv);
            document.getElementById('npvValue').className = 'metric-value ' + (npv > 0 ? 'positive' : 'negative');
            document.getElementById('npvDescription').textContent = npv > 0 ? 'Karlı Proje' : 'Zararlı Proje';

            document.getElementById('irrValue').textContent = irr.toFixed(1) + '%';
            document.getElementById('irrValue').className = 'metric-value ' + (irr > wacc * 100 ? 'positive' : 'negative');
            document.getElementById('irrDescription').textContent = irr > wacc * 100 ? 'WACC\'tan Yüksek' : 'WACC\'tan Düşük';

            document.getElementById('roiValue').textContent = roi.toFixed(1) + '%';
            document.getElementById('roiValue').className = 'metric-value ' + (roi > 0 ? 'positive' : 'negative');
            document.getElementById('roiDescription').textContent = roi > 100 ? 'Çok İyi' : roi > 0 ? 'Pozitif' : 'Negatif';

            if (paybackPeriod > 0) {
                const years = Math.floor(paybackPeriod);
                const months = Math.round((paybackPeriod - years) * 12);
                document.getElementById('paybackValue').textContent = years + '.' + months + ' yıl';
                document.getElementById('paybackValue').className = 'metric-value ' + (paybackPeriod < 3 ? 'positive' : paybackPeriod < 5 ? 'neutral' : 'negative');
            } else {
                document.getElementById('paybackValue').textContent = 'Yok';
                document.getElementById('paybackValue').className = 'metric-value negative';
            }

            document.getElementById('ltvCacValue').textContent = avgLtvCac.toFixed(1);
            document.getElementById('ltvCacValue').className = 'metric-value ' + (avgLtvCac > 3 ? 'positive' : avgLtvCac > 1 ? 'neutral' : 'negative');

            document.getElementById('breakEvenCustomers').textContent = breakEvenCustomers.toLocaleString();
            document.getElementById('breakEvenCustomers').className = 'metric-value neutral';

            // Tabloları doldur
            fillSummaryTable(yearlyData, cashFlows, cumulativeNPV, wacc);
            fillDetailedTable(yearlyData);
            fillMetricsTable(yearlyData);

            document.getElementById('results').style.display = 'block';
        }

        function fillSummaryTable(yearlyData, cashFlows, cumulativeNPV, wacc) {
            const tbody = document.getElementById('summaryBody');
            tbody.innerHTML = '';

            // İlk satır - başlangıç yatırımı
            const initialRow = tbody.insertRow();
            initialRow.innerHTML = `
                    <td>0</td>
                    <td>-</td>
                    <td>-</td>
                    <td>${formatCurrency(Math.abs(cashFlows[0]))}</td>
                    <td class="negative">${formatCurrency(cashFlows[0])}</td>
                    <td class="negative">${formatCurrency(cashFlows[0])}</td>
                    <td class="negative">${formatCurrency(cashFlows[0])}</td>
                    <td class="negative">${formatCurrency(cashFlows[0])}</td>
                    <td class="negative">${formatCurrency(cumulativeNPV[0])}</td>
                `;

            yearlyData.forEach((data, index) => {
                const row = tbody.insertRow();
                const discountedCashFlow = data.cashFlow / Math.pow(1 + wacc, data.year);

                row.innerHTML = `
                        <td>${data.year}</td>
                        <td>${Math.round(data.customers).toLocaleString()}</td>
                        <td class="positive">${formatCurrency(data.totalRevenue)}</td>
                        <td class="negative">${formatCurrency(data.totalExpenses)}</td>
                        <td class="${data.ebitda > 0 ? 'positive' : 'negative'}">${formatCurrency(data.ebitda)}</td>
                        <td class="${data.netIncome > 0 ? 'positive' : 'negative'}">${formatCurrency(data.netIncome)}</td>
                        <td class="${data.cashFlow > 0 ? 'positive' : 'negative'}">${formatCurrency(data.cashFlow)}</td>
                        <td class="${discountedCashFlow > 0 ? 'positive' : 'negative'}">${formatCurrency(discountedCashFlow)}</td>
                        <td class="${cumulativeNPV[index + 1] > 0 ? 'positive' : 'negative'}">${formatCurrency(cumulativeNPV[index + 1])}</td>
                    `;
            });
        }

        function fillDetailedTable(yearlyData) {
            const tbody = document.getElementById('detailedBody');
            tbody.innerHTML = '';

            yearlyData.forEach(data => {
                const row = tbody.insertRow();
                row.innerHTML = `
                        <td>${data.year}</td>
                        <td class="positive">${formatCurrency(data.subscriptionRevenue)}</td>
                        <td class="negative">${formatCurrency(data.personnelCost)}</td>
                        <td class="negative">${formatCurrency(data.operationalCost)}</td>
                        <td class="negative">${formatCurrency(data.variableCosts)}</td>
                        <td class="negative">${formatCurrency(data.cacCosts)}</td>
                        <td class="negative">${formatCurrency(data.depreciation)}</td>
                        <td class="negative">${formatCurrency(data.taxes)}</td>
                    `;
            });
        }

        function fillMetricsTable(yearlyData) {
            const tbody = document.getElementById('metricsBody');
            tbody.innerHTML = '';

            yearlyData.forEach(data => {
                const row = tbody.insertRow();
                row.innerHTML = `
                        <td>${data.year}</td>
                        <td>${formatCurrency(data.arpu)}</td>
                        <td>${(data.churnRate * 100).toFixed(1)}%</td>
                        <td>${formatCurrency(data.ltv)}</td>
                        <td>${formatCurrency(parseFloat(document.getElementById('cac').value))}</td>
                        <td class="${data.ltvCacRatio > 3 ? 'positive' : data.ltvCacRatio > 1 ? 'neutral' : 'negative'}">${data.ltvCacRatio.toFixed(1)}</td>
                        <td class="${data.grossMargin > 0.7 ? 'positive' : data.grossMargin > 0.5 ? 'neutral' : 'negative'}">${(data.grossMargin * 100).toFixed(1)}%</td>
                        <td class="${data.netMargin > 0.2 ? 'positive' : data.netMargin > 0 ? 'neutral' : 'negative'}">${(data.netMargin * 100).toFixed(1)}%</td>
                    `;
            });
        }

        function showTab(tabName) {
            // Tüm tabları gizle
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });

            // Seçili tabı göster
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('tr-TR', {
                style: 'currency',
                currency: 'TRY',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Sayfa yüklendiğinde örnek hesaplama
        window.onload = function () {
            calculateDetailedMetrics();
        };
    </script>
</body>
</html>